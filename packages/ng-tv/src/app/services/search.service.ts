import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
// import { pipe, tap } from 'rxjs';
import { Observable, throwError, BehaviorSubject } from 'rxjs';
import { catchError, retry } from 'rxjs/operators';


@Injectable({
  providedIn: 'root'
})
export class SearchService {

  public shows: BehaviorSubject<any>;

  constructor(private http: HttpClient) {
    // this.shows = new BehaviorSubject([]);
    const response = [{"score":29.020636,"show":{"id":490,"url":"http://www.tvmaze.com/shows/490/star-trek","name":"Star Trek","type":"Scripted","language":"English","genres":["Adventure","Science-Fiction"],"status":"Ended","runtime":60,"premiered":"1966-09-08","officialSite":null,"schedule":{"time":"20:30","days":["Thursday"]},"rating":{"average":8.5},"weight":99,"network":{"id":1,"name":"NBC","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"webChannel":null,"externals":{"tvrage":5333,"thetvdb":77526,"imdb":"tt0060028"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/70/176259.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/70/176259.jpg"},"summary":"<p>The original <b>Star Trek</b> series focuses on the 23rd century adventures of Captain James T. Kirk and the U.S.S. <i>Enterprise </i>(NCC-1701), a powerful interstellar spacecraft dispatched by Earth-based Starfleet Command to explore the galaxy. Kirk commands a crew of 430 men and women aboard his starship, which can travel at speeds surpassing the speed of light. Kirk's five-year mission—and his mandate from Starfleet—is to seek out new life and new civilizations, and to boldly go where no man has gone before.</p>","updated":1561415522,"_links":{"self":{"href":"http://api.tvmaze.com/shows/490"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/44455"}}}},{"score":25.406513,"show":{"id":42193,"url":"http://www.tvmaze.com/shows/42193/star-trek-picard","name":"Star Trek: Picard","type":"Scripted","language":"English","genres":["Drama","Science-Fiction"],"status":"In Development","runtime":60,"premiered":null,"officialSite":"https://www.cbs.com/shows/star-trek-picard/","schedule":{"time":"","days":[]},"rating":{"average":null},"weight":99,"network":null,"webChannel":{"id":107,"name":"CBS All Access","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"externals":{"tvrage":null,"thetvdb":364093,"imdb":"tt8806524"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/204/512066.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/204/512066.jpg"},"summary":"<p>The series is set 18 years after Jean-Luc Picard's last appearance in <i>Star Trek: Nemesis</i> (2002) and finds the character deeply affected by the destruction of Romulus as depicted in the film <i>Star Trek</i> (2009).</p>","updated":1563654243,"_links":{"self":{"href":"http://api.tvmaze.com/shows/42193"}}}},{"score":25.345898,"show":{"id":7480,"url":"http://www.tvmaze.com/shows/7480/star-trek-discovery","name":"Star Trek: Discovery","type":"Scripted","language":"English","genres":["Drama","Adventure","Science-Fiction"],"status":"Running","runtime":60,"premiered":"2017-09-24","officialSite":"http://www.cbs.com/shows/star-trek-discovery/","schedule":{"time":"20:30","days":["Thursday"]},"rating":{"average":7.8},"weight":98,"network":null,"webChannel":{"id":107,"name":"CBS All Access","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"externals":{"tvrage":null,"thetvdb":328711,"imdb":"tt5171438"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/177/444251.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/177/444251.jpg"},"summary":"<p>Star Trek, one of the most iconic and influential global television franchises, returns 50 years after it first premiered, with <b>Star Trek: Discovery</b>. The series will feature a new ship, new characters and new missions, while embracing the same ideology and hope for the future that inspired a generation of dreamers and doers.</p>","updated":1564704620,"_links":{"self":{"href":"http://api.tvmaze.com/shows/7480"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/1613094"}}}},{"score":24.773623,"show":{"id":39744,"url":"http://www.tvmaze.com/shows/39744/star-trek-short-treks","name":"Star Trek: Short Treks","type":"Scripted","language":"English","genres":["Drama","Science-Fiction"],"status":"Running","runtime":15,"premiered":"2018-10-04","officialSite":"https://www.cbspressexpress.com/cbs-all-access/shows/star-trek-short-treks/about","schedule":{"time":"21:30","days":[]},"rating":{"average":8.1},"weight":86,"network":null,"webChannel":{"id":107,"name":"CBS All Access","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"externals":{"tvrage":null,"thetvdb":355391,"imdb":"tt9059594"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/174/436929.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/174/436929.jpg"},"summary":"<p>Each of the <b>Star Trek: Short Treks</b> four stories centers on a key character, including familiar faces from <i>Star Trek: Discovery:</i> Tilly, Saru and Harry Mudd, as well as a new character unfamiliar to fans, Craft.</p>","updated":1563653649,"_links":{"self":{"href":"http://api.tvmaze.com/shows/39744"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/1565217"}}}},{"score":24.072025,"show":{"id":39323,"url":"http://www.tvmaze.com/shows/39323/star-trek-lower-decks","name":"Star Trek: Lower Decks","type":"Animation","language":"English","genres":["Comedy","Science-Fiction"],"status":"In Development","runtime":30,"premiered":null,"officialSite":null,"schedule":{"time":"","days":[]},"rating":{"average":null},"weight":80,"network":null,"webChannel":{"id":107,"name":"CBS All Access","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"externals":{"tvrage":null,"thetvdb":null,"imdb":null},"image":null,"summary":"<p><b>Star Trek: Lower Decks</b> follows the support crew serving on one of Starfleet's least important ships.</p>","updated":1563653460,"_links":{"self":{"href":"http://api.tvmaze.com/shows/39323"}}}},{"score":23.781261,"show":{"id":492,"url":"http://www.tvmaze.com/shows/492/star-trek-voyager","name":"Star Trek: Voyager","type":"Scripted","language":"English","genres":["Adventure","Science-Fiction"],"status":"Ended","runtime":60,"premiered":"1995-01-16","officialSite":null,"schedule":{"time":"21:00","days":["Wednesday"]},"rating":{"average":8.1},"weight":81,"network":{"id":70,"name":"UPN","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"webChannel":null,"externals":{"tvrage":5338,"thetvdb":74550,"imdb":"tt0112178"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/70/176260.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/70/176260.jpg"},"summary":"<p><b>Star Trek: Voyager</b> (VOY) focuses on the 24th century adventures of Captain Kathryn Janeway aboard the U.S.S. Voyager. Smaller than either Kirk's or Picard's starships—its crew complement is only 150—Voyager is fast and powerful, and has the ability to land on a planet's surface. It is one of the most technologically advanced vessels in Starfleet, utilizing computer circuitry that incorporates synthetic neural tissue. Ironically, Janeway's inaugural mission aboard Voyager was to be her last in the Alpha quadrant. While attempting to capture the crew of a renegade Maquis vessel, both her ship and that of the Maquis were pulled into the distant Delta quadrant by powerful alien technology. Unfortunately, there would be no similar \"express\" route to take them home again. Stranded 70,000 light-years from Earth, Janeway convinced the Maquis to join her Starfleet crew and serve together during the long voyage back to Federation space.</p>","updated":1559490824,"_links":{"self":{"href":"http://api.tvmaze.com/shows/492"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/44806"}}}},{"score":23.070269,"show":{"id":714,"url":"http://www.tvmaze.com/shows/714/star-trek-enterprise","name":"Star Trek: Enterprise","type":"Scripted","language":"English","genres":["Adventure","Science-Fiction"],"status":"Ended","runtime":60,"premiered":"2001-09-26","officialSite":null,"schedule":{"time":"12:00","days":["Friday"]},"rating":{"average":8.2},"weight":84,"network":{"id":70,"name":"UPN","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"webChannel":null,"externals":{"tvrage":5335,"thetvdb":73893,"imdb":"tt0244365"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/6/15045.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/6/15045.jpg"},"summary":"<p><b>Star Trek: Enterprise</b> (ENT) focuses on the 22nd century adventures of Captain Jonathan Archer aboard the Enterprise NX-01 during the early days of interstellar travel. The NX designation indicates that this Enterprise is an experimental prototype; AUnlike the starships of the four other <i>Star Trek </i>series, this Enterprise doesn't have deflector shields or phasers, but it does come equipped with a phase cannon and a rudimentary transporter that functions efficiently most of the time.</p>","updated":1555193094,"_links":{"self":{"href":"http://api.tvmaze.com/shows/714"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/63356"}}}},{"score":21.379942,"show":{"id":493,"url":"http://www.tvmaze.com/shows/493/star-trek-deep-space-nine","name":"Star Trek: Deep Space Nine","type":"Scripted","language":"English","genres":["Adventure","Science-Fiction"],"status":"Ended","runtime":60,"premiered":"1993-01-03","officialSite":null,"schedule":{"time":"","days":["Wednesday"]},"rating":{"average":8.4},"weight":79,"network":{"id":72,"name":"Syndication","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"webChannel":null,"externals":{"tvrage":5334,"thetvdb":72073,"imdb":"tt0106145"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/70/176262.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/70/176262.jpg"},"summary":"<p><b>Star Trek: Deep Space Nine</b> (DS9) focuses on the 24th century adventures of Captain Benjamin Sisko on space station Deep Space 9, an outpost situated near the mouth of a stable wormhole on the far reaches of explored space. Although Sisko commands Deep Space 9, the station actually belongs to the inhabitants of nearby Bajor, who requested Starfleet's protective presence after Bajoran freedom fighters put an end to the brutal Cardassian occupation of their world. Approximately a sixth of the station's 300 permanent residents are Starfleet personnel; there is also a sizable Bajoran militia presence. The rest of Deep Space 9's inhabitants are civilians, most of whom work in the station's Promenade, a kind of indoor marketplace. Initially, Sisko's mandate from Starfleet was to protect Bajor and the station from any hostiles who ventured into the area. But with the discovery of the nearby wormhole—a shortcut through space that leads directly to the uncharted Gamma quadrant—Sisko's mandate has expanded exponentially, as the region becomes the gateway to all manner of visitors, both friendly and extremely hostile.</p>","updated":1553174921,"_links":{"self":{"href":"http://api.tvmaze.com/shows/493"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/44982"}}}},{"score":21.263395,"show":{"id":491,"url":"http://www.tvmaze.com/shows/491/star-trek-the-next-generation","name":"Star Trek: The Next Generation","type":"Scripted","language":"English","genres":["Adventure","Science-Fiction"],"status":"Ended","runtime":60,"premiered":"1987-09-28","officialSite":null,"schedule":{"time":"","days":[]},"rating":{"average":9},"weight":92,"network":{"id":72,"name":"Syndication","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"webChannel":null,"externals":{"tvrage":5337,"thetvdb":71470,"imdb":"tt0092455"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/70/176261.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/70/176261.jpg"},"summary":"<p><b>Star Trek: The Next Generation</b> (TNG) focuses on the 24th century adventures of Captain Jean-Luc Picard aboard the U.S.S. Enterprise (NCC-1701-D). This incarnation of the famous starship is much larger than the one captained by James T. Kirk a century earlier, and, accordingly, it carries a larger crew complement: 1,012 men, women…and, surprisingly, children. This era's Starfleet Command believes that men and women are more likely to sign up for long-term exploratory missions if they think of their ship as home. Thus, Picard's crew enjoys many of the comforts they'd have otherwise left behind, including a wide variety of recreational opportunities, \"replicated\" food dishes to suit every palate, and quarters large enough to share with spouses and offspring. There are schools for the children and a bar (stocked with synthetic alcohol, or synthehol) where the adults can unwind. However, the ongoing mission—no longer limited to a mere five years—remains virtually the same as it was during Kirk's time: to seek out new life and new civilizations, and to boldly go where no one has gone before.</p>","updated":1562569512,"_links":{"self":{"href":"http://api.tvmaze.com/shows/491"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/44633"}}}},{"score":20.884151,"show":{"id":11921,"url":"http://www.tvmaze.com/shows/11921/star-trek-new-voyages","name":"Star Trek: New Voyages","type":"Scripted","language":"English","genres":["Adventure","Science-Fiction"],"status":"Ended","runtime":52,"premiered":"2004-01-16","officialSite":"http://www.stnv.de/","schedule":{"time":"","days":[]},"rating":{"average":null},"weight":71,"network":null,"webChannel":{"id":121,"name":"stnv.de","country":{"name":"United States","code":"US","timezone":"America/New_York"}},"externals":{"tvrage":31549,"thetvdb":79256,"imdb":"tt0458122"},"image":{"medium":"http://static.tvmaze.com/uploads/images/medium_portrait/78/195057.jpg","original":"http://static.tvmaze.com/uploads/images/original_untouched/78/195057.jpg"},"summary":"<p><b>Star Trek: New Voyages</b> is an award-winning independent webseries that produces new episodes of <i>Classic Star Trek</i>. Continuing the fourth and fifth seasons of the original series, we film the untold stories of the U.S.S. Enterprise, Captain Kirk, and his crew with the intention of filling in the missing years of the original five year mission, and bridging the gap to <i>Star Trek: The Motion Picture</i>.</p><p>We are a group of fans who have come together with a common love for the classic era <i>Star Trek</i> for the purpose of having fun while making new episodes. It is the goal of <i>Star Trek: New Voyages</i> to support and promote the CBS/Paramount Star Trek franchise by giving fans an active way to continue their interest in <i>Classic Star Trek</i>.</p>","updated":1552090153,"_links":{"self":{"href":"http://api.tvmaze.com/shows/11921"},"previousepisode":{"href":"http://api.tvmaze.com/episodes/575844"}}}}]
    this.shows = new BehaviorSubject(response);
    this.shows.subscribe((val) => {
      console.log('shows updated ', val);
    });
  }

  public getShows(query) {
    return this.http.get(`http://api.tvmaze.com/search/shows?q=${query}`)
    .subscribe((res: Array<any>) => {

      const nextShows = [...this.shows.value, ...res]
        .reduce((aggr, curr) => {
          if (aggr.length > 0) {
            for (let i = 0; i < aggr.length; i++) {
              if (aggr[i].show.id === curr.show.id) {
                return [...aggr];
              }
            }
          }
          return [...aggr, curr];
        }, []);
      this.shows.next(nextShows);
    });
  }
}
